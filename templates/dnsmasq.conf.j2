# {{ ansible_managed }}
# Configuration file for dnsmasq.

domain-needed
bogus-priv

{% for interface in dnsmasq_listen_interfaces %}
interface={{ interface }}
{% endfor %}

expand-hosts
domain={{ dnsmasq_domain_name }}

# Static DHCP Ranges
{% for range in dnsmasq_dhcp_ranges %}
dhcp-range={% if 'tag' in range %}set:{{ range.tag }},{% endif %}{{ range.network }},static
{% endfor %}

# Static DHCP Leases
{% for host in dnsmasq_host_list %}
dhcp-host={{ host.mac }},{{ host.name }},{{ host.address }},{{ dnsmasq_lease_time }}
    {%- if 'tag' in host %},set:{{ host.tag }}{% endif %}

{% endfor %}

dhcp-authoritative
dhcp-ignore=tag:!known
dhcp-option=tag:nodefroute,option:router

{% if dnsmasq_provide_pxe %}
enable-tftp
tftp-root={{ dnsmasq_tftp_path }}

dhcp-match=efiboot,option:client-arch,7

dhcp-boot=tag:efiboot,grubx64.efi
dhcp-boot=tag:!efiboot,pxelinux.0
{% endif %}

